<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Index Calculator</title>
</head>
<body>
    <div id="CalculatorContainer"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('CalculatorContainer');
            
            // Set the HTML content within the container
            container.innerHTML = `
                <div class="heat-index-calculator">
                    <h2>Heat Index Calculator</h2>
                    <div class="calculator-inputs">
                        <div class="calculator-input">
                            <label for="temperature">Temperature (°F):</label>
                            <input type="number" id="temperature" placeholder="80-100°F" min="80" max="100">
                            <div id="temp-error" class="error-message"></div>
                        </div>
                        <div class="calculator-input">
                            <label for="humidity">Relative Humidity (%):</label>
                            <input type="number" id="humidity" placeholder="40-80%" min="40" max="80">
                            <div id="humidity-error" class="error-message"></div>
                        </div>
                    </div>
                    <button id="calculate-btn">Calculate Heat Index</button>
                    <div id="result" class="calculator-result">
                        <p>Heat Index: <span id="heat-index">--</span> °F (<span id="heat-index-c">--</span> °C)</p>
                        <p>Risk Level: <span id="risk-level">--</span></p>
                        <p id="calculation-method"></p>
                    </div>
                </div>
            `;

            // Create a style element with scoped CSS
            const style = document.createElement('style');
            style.innerHTML = `
                #CalculatorContainer .heat-index-calculator {
                    font-family: Arial, sans-serif;
                    max-width: 100%;
                    width: 400px;
                    margin: 20px auto;
                    padding: 20px;
                    border: 1px solid #ddd;
                    border-radius: 5px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                    background-color: #f9f9f9;
                    box-sizing: border-box;
                }

                #CalculatorContainer .heat-index-calculator h2 {
                    color: #333;
                    text-align: center;
                    margin-bottom: 20px;
                    font-size: 1.5rem;
                }

                #CalculatorContainer .calculator-inputs {
                    margin-bottom: 15px;
                }

                #CalculatorContainer .calculator-input {
                    margin-bottom: 15px;
                }

                #CalculatorContainer .calculator-input label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: bold;
                }

                #CalculatorContainer .calculator-input input {
                    width: 100%;
                    padding: 12px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    box-sizing: border-box;
                    font-size: 16px;
                }

                #CalculatorContainer .error-message {
                    color: #f44336;
                    font-size: 0.8em;
                    margin-top: 5px;
                    height: 15px;
                }

                #CalculatorContainer button {
                    width: 100%;
                    padding: 12px;
                    background-color: #ad2a24;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 16px;
                    margin-top: 10px;
                }

                #CalculatorContainer button:hover {
                    background-color: #8c221d;
                }

                #CalculatorContainer .calculator-result {
                    margin-top: 20px;
                    padding: 15px;
                    background-color: #e9f7ef;
                    border-radius: 4px;
                    text-align: center;
                }

                #CalculatorContainer #risk-level {
                    font-weight: bold;
                }

                #CalculatorContainer .caution {
                    color: #ff9800;
                }

                #CalculatorContainer .extreme-caution {
                    color: #ff5722;
                }

                #CalculatorContainer .danger {
                    color: #f44336;
                    font-weight: bold;
                }

                #CalculatorContainer .extreme-danger {
                    color: #d32f2f;
                    font-weight: bold;
                    text-transform: uppercase;
                }

                #CalculatorContainer #calculation-method {
                    font-style: italic;
                    font-size: 0.9em;
                    margin-top: 10px;
                    color: #666;
                }

                /* Mobile responsiveness */
                @media (max-width: 480px) {
                    #CalculatorContainer .heat-index-calculator {
                        width: 90%;
                        padding: 15px;
                    }
                    
                    #CalculatorContainer .calculator-input input {
                        padding: 10px;
                    }
                    
                    #CalculatorContainer button {
                        padding: 10px;
                    }
                    
                    #CalculatorContainer .heat-index-calculator h2 {
                        font-size: 1.3rem;
                    }
                }
            `;
            document.head.appendChild(style);

            // Initialize event listeners
            document.getElementById('calculate-btn').addEventListener('click', calculateHeatIndex);
            
            // Calculate on Enter key press
            document.getElementById('temperature').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') calculateHeatIndex();
            });
            document.getElementById('humidity').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') calculateHeatIndex();
            });

            function calculateHeatIndex() {
                // Clear previous errors and results
                document.getElementById('temp-error').textContent = '';
                document.getElementById('humidity-error').textContent = '';
                document.getElementById('calculation-method').textContent = '';
                
                // Get input values
                const tempInput = document.getElementById('temperature').value.trim();
                const humidityInput = document.getElementById('humidity').value.trim();
                
                // Validate inputs
                let isValid = true;
                
                // Temperature validation
                if (tempInput === '') {
                    document.getElementById('temp-error').textContent = 'Please enter temperature between 80°F and 100°F';
                    isValid = false;
                } else if (isNaN(tempInput)) {
                    document.getElementById('temp-error').textContent = 'Temperature must be a number between 80 and 100';
                    isValid = false;
                } else {
                    const tempF = parseFloat(tempInput);
                    if (tempF < 80 || tempF > 100) {
                        document.getElementById('temp-error').textContent = 'Temperature must be between 80°F and 100°F';
                        isValid = false;
                    }
                }
                
                // Humidity validation
                if (humidityInput === '') {
                    document.getElementById('humidity-error').textContent = 'Please enter humidity between 40% and 80%';
                    isValid = false;
                } else if (isNaN(humidityInput)) {
                    document.getElementById('humidity-error').textContent = 'Humidity must be a number between 40 and 80';
                    isValid = false;
                } else {
                    const humidity = parseFloat(humidityInput);
                    if (humidity < 40 || humidity > 80) {
                        document.getElementById('humidity-error').textContent = 'Humidity must be between 40% and 80%';
                        isValid = false;
                    }
                }
                
                if (!isValid) {
                    // Clear results if inputs are invalid
                    document.getElementById('heat-index').textContent = '--';
                    document.getElementById('heat-index-c').textContent = '--';
                    document.getElementById('risk-level').textContent = '--';
                    document.getElementById('risk-level').className = '';
                    return;
                }
                
                const tempF = parseFloat(tempInput);
                const humidity = parseFloat(humidityInput);
                
                // Calculate Heat Index using the Rothfusz regression
                let heatIndex = -42.379 + 2.04901523 * tempF + 10.14333127 * humidity 
                               - 0.22475541 * tempF * humidity - 6.83783e-3 * tempF * tempF 
                               - 5.481717e-2 * humidity * humidity 
                               + 1.22874e-3 * tempF * tempF * humidity 
                               + 8.5282e-4 * tempF * humidity * humidity 
                               - 1.99e-6 * tempF * tempF * humidity * humidity;
                
                // Adjustments for very high or low humidity
                if (humidity < 13 && tempF >= 80 && tempF <= 112) {
                    heatIndex -= ((13 - humidity) / 4) * Math.sqrt((17 - Math.abs(tempF - 95)) / 17);
                } else if (humidity > 85 && tempF >= 80 && tempF <= 87) {
                    heatIndex += ((humidity - 85) / 10) * ((87 - tempF) / 5);
                }
                
                // Round to nearest integer
                heatIndex = Math.round(heatIndex);
                
                // Convert to Celsius
                const heatIndexC = Math.round((heatIndex - 32) * 5 / 9);
                
                // Display results
                document.getElementById('heat-index').textContent = heatIndex;
                document.getElementById('heat-index-c').textContent = heatIndexC;
                document.getElementById('calculation-method').textContent = 'Calculated using Rothfusz regression formula';
                
                // Determine risk level
                const riskLevel = document.getElementById('risk-level');
                riskLevel.className = '';
                
                if (heatIndex < 80) {
                    riskLevel.textContent = 'No risk';
                } else if (heatIndex >= 80 && heatIndex <= 90) {
                    riskLevel.textContent = 'Caution';
                    riskLevel.classList.add('caution');
                } else if (heatIndex > 90 && heatIndex <= 103) {
                    riskLevel.textContent = 'Extreme Caution';
                    riskLevel.classList.add('extreme-caution');
                } else if (heatIndex > 103 && heatIndex <= 124) {
                    riskLevel.textContent = 'Danger';
                    riskLevel.classList.add('danger');
                } else if (heatIndex > 124) {
                    riskLevel.textContent = 'EXTREME DANGER';
                    riskLevel.classList.add('extreme-danger');
                }
            }
        });
    </script>
</body>
</html>